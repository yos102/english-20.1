<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>××‘×—×Ÿ ×× ×’×œ×™×ª ×›×™×ª×” ×“ 20.1</title>
    <style>
        :root { --primary: #4a90e2; --success: #48bb78; --error: #f56565; --bg: #f0f4f8; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background-color: var(--bg); margin: 0; padding: 10px; line-height: 1.6; padding-bottom: 60px; overflow-x: hidden; touch-action: manipulation; text-align: right; }
        .container { max-width: 950px; margin: auto; background: white; padding: 15px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); position: relative; z-index: 1; }
        h1 { color: #2d3748; text-align: center; font-size: 1.5rem; }
        h3 { border-right: 5px solid var(--primary); padding-right: 15px; background: #f8fbff; padding: 10px; border-radius: 0 10px 10px 0; margin-top: 25px; text-align: right; font-size: 1.1rem; }
        
        .matching-container { display: flex; justify-content: space-between; align-items: flex-start; padding: 10px; gap: 20px; }
        .column { display: flex; flex-direction: column; gap: 12px; width: 45%; }
        
        .match-item { 
            padding: 12px 5px; background: #edf2f7; border: 2px solid #cbd5e0; border-radius: 12px; 
            cursor: pointer; text-align: center; font-weight: bold; transition: 0.2s; position: relative;
            font-size: 0.95rem; word-break: break-word; min-height: 45px; display: flex; align-items: center; justify-content: center;
        }
        .match-item.selected { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.3); transform: scale(1.02); }
        .match-item.checked-correct { background: var(--success) !important; color: white !important; border-color: #38a169 !important; }
        .match-item.checked-wrong { background: var(--error) !important; color: white !important; border-color: #c53030 !important; }

        .word-bank { background: #fff9c4; padding: 15px; border-radius: 15px; margin: 15px 0; text-align: center; border: 2px dashed #fbc02d; }
        .drag-item { 
            display: inline-block; padding: 8px 12px; background: white; border: 2px solid var(--primary);
            border-radius: 12px; cursor: grab; margin: 4px; font-weight: bold; color: var(--primary); font-size: 0.9rem;
            user-select: none;
        }
        .drag-item:active { cursor: grabbing; }
        .drag-item.selected-item { background: var(--primary); color: white; }
        .drag-item.used { opacity: 0.2; text-decoration: line-through; pointer-events: none; filter: grayscale(1); }

        .drop-zone, .img-drop-zone { 
            display: inline-block; min-width: 80px; padding: 5px; border-bottom: 3px solid var(--primary); 
            background: #f7fafc; vertical-align: middle; text-align: center; border-radius: 5px 5px 0 0; min-height: 30px; cursor: pointer;
        }
        .drop-zone.drag-over, .img-drop-zone.drag-over { background: #e2e8f0; border-color: #2d3748; }
        .img-drop-zone { width: 90%; margin: 8px auto; border: 2px dashed var(--primary); color: #a0aec0; }
        
        .ltr-text { direction: ltr; text-align: left; }
        .sentence-row { margin-bottom: 15px; font-size: 1rem; display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
        .correct-ans { border-color: var(--success) !important; color: var(--success); background: #f0fff4; }
        .wrong-ans { border-color: var(--error) !important; color: var(--error); background: #fff5f5; }
        .correction-text { color: var(--success); font-weight: bold; font-size: 0.85em; display: block; }

        .img-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .img-card { background: #f8fbff; padding: 10px; border-radius: 15px; text-align: center; border: 1px solid #e2e8f0; }
        .emoji-img { font-size: 40px; display: block; }

        .btn-check { width: 100%; padding: 15px; background: #2d3748; color: white; border: none; border-radius: 15px; font-size: 1.2em; cursor: pointer; margin-top: 30px; transition: 0.3s; }
        
        #final-result { display:none; text-align:center; margin-top:25px; padding:20px; border-radius:20px; background: #edf2f7; }
        .feedback-icon { font-size: 3.5rem; display: block; }
        .speak-btn { background: none; border: none; cursor: pointer; font-size: 1.2rem; padding: 5px; }
        footer { position: relative; margin-top: 20px; text-align: center; font-size: 0.8rem; color: #a0aec0; }

        @media (max-width: 480px) {
            .matching-container { padding: 0; gap: 10px; }
            .column { gap: 8px; }
            .match-item { font-size: 0.85rem; padding: 10px 4px; }
            h1 { font-size: 1.3rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>××‘×—×Ÿ ×× ×’×œ×™×ª ×›×™×ª×” ×“ 20.1</h1>
    
    <h3>1. ×”×ª×× ×‘×™×Ÿ ×”××™×œ×” ×œ×¢×‘×¨×™×ª</h3>
    <div class="matching-container">
        <div class="column" id="eng-col"></div>
        <div class="column" id="heb-col"></div>
    </div>

    <h3>2. ×”×©×œ× ××ª ×”××©×¤×˜×™×</h3>
    <div id="s-bank" class="word-bank"></div>
    <div id="s-questions" class="ltr-text"></div>

    <h3>3. ××” ×”××™×œ×” ×”××ª××™××” ×œ×ª××•× ×”?</h3>
    <div id="i-bank" class="word-bank"></div>
    <div id="i-questions" class="img-grid"></div>

    <button class="btn-check" id="main-btn" onclick="calculateGrade()">×¡×™×™××ª×™! ×‘×“×•×§ ×œ×™ ××ª ×”×¦×™×•×Ÿ ğŸ“</button>
    
    <div id="final-result">
        <span id="feedback-emoji" class="feedback-icon"></span>
        <h2 id="grade-text"></h2>
        <p id="feedback-msg"></p>
        <button class="btn-check" style="background: var(--primary)" onclick="location.reload()">××‘×—×Ÿ ×—×“×© ğŸ”„</button>
    </div>
</div>

<footer>××‘×—×Ÿ ×× ×’×œ×™×ª ×›×™×ª×” ×“ 20.1</footer>

<script>
    const fullList = [
        { en: "food", he: "××•×›×œ", emoji: "ğŸ²" }, { en: "drinks", he: "×©×ª×™×™×”", emoji: "ğŸ¥¤" },
        { en: "chocolate", he: "×©×•×§×•×œ×“", emoji: "ğŸ«" }, { en: "coffee", he: "×§×¤×”", emoji: "â˜•" },
        { en: "cookie", he: "×¢×•×’×™×™×”", emoji: "ğŸª" }, { en: "jam", he: "×¨×™×‘×”", emoji: "ğŸ“" },
        { en: "juice", he: "××™×¥", emoji: "ğŸ§ƒ" }, { en: "salad", he: "×¡×œ×˜", emoji: "ğŸ¥—" },
        { en: "sandwich", he: "×¡× ×“×•×•×™×¥'", emoji: "ğŸ¥ª" }, { en: "tea", he: "×ª×”", emoji: "ğŸµ" },
        { en: "water", he: "××™×", emoji: "ğŸ’§" }, { en: "apple", he: "×ª×¤×•×—", emoji: "ğŸ" },
        { en: "lemon", he: "×œ×™××•×Ÿ", emoji: "ğŸ‹" }, { en: "pizza", he: "×¤×™×¦×”", emoji: "ğŸ•" },
        { en: "egg", he: "×‘×™×¦×”", emoji: "ğŸ¥š" }, { en: "drink", he: "×œ×©×ª×•×ª", emoji: "ğŸ¥›" },
        { en: "eat", he: "×œ××›×•×œ", emoji: "ğŸ½ï¸" }, { en: "sister", he: "××—×•×ª", emoji: "ğŸ‘§" },
        { en: "dad", he: "××‘×", emoji: "ğŸ‘¨" }, { en: "baby", he: "×ª×™× ×•×§", emoji: "ğŸ‘¶" },
        { en: "mom", he: "×××", emoji: "ğŸ‘©" }, { en: "bananas", he: "×‘× × ×•×ª", emoji: "ğŸŒ" },
        { en: "milk", he: "×—×œ×‘", emoji: "ğŸ¼" }, { en: "grandmother", he: "×¡×‘×ª×", emoji: "ğŸ‘µ" },
        { en: "grandfather", he: "×¡×‘×", emoji: "ğŸ‘´" }, { en: "family", he: "××©×¤×—×”", emoji: "ğŸ‘ª" },
        { en: "cheese", he: "×’×‘×™× ×”", emoji: "ğŸ§€" }, { en: "chicken", he: "×¢×•×£", emoji: "ğŸ—" },
        { en: "children", he: "×™×œ×“×™×", emoji: "ğŸ§’" }, { en: "chips", he: "×¦'×™×¤×¡", emoji: "ğŸŸ" },
        { en: "kitchen", he: "××˜×‘×—", emoji: "ğŸ³" }, { en: "spinach", he: "×ª×¨×“", emoji: "ğŸŒ¿" },
        { en: "chair", he: "×›×™×¡×", emoji: "ğŸª‘" }, { en: "teacher", he: "××•×¨×”", emoji: "ğŸ‘©â€ğŸ«" },
        { en: "what do you want?", he: "××” ××ª×” ×¨×•×¦×”?", emoji: "â“" },
        { en: "under", he: "××ª×—×ª", emoji: "â¬‡ï¸" }, { en: "on", he: "×¢×œ", emoji: "ğŸ”" },
        { en: "in", he: "×‘×ª×•×š", emoji: "ğŸ“¥" }, { en: "I like", he: "×× ×™ ××•×”×‘", emoji: "â¤ï¸" },
        { en: "I don't like", he: "×× ×™ ×œ× ××•×”×‘", emoji: "ğŸ’”" }, { en: "bread", he: "×œ×—×", emoji: "ğŸ" },
        { en: "fish", he: "×“×’", emoji: "ğŸŸ" }, { en: "hungry", he: "×¨×¢×‘", emoji: "ğŸ˜‹" },
        { en: "meat", he: "×‘×©×¨", emoji: "ğŸ¥©" }, { en: "restaurant", he: "××¡×¢×“×”", emoji: "ğŸ´" },
        { en: "I'm hungry", he: "×× ×™ ×¨×¢×‘", emoji: "ğŸ¥£" }, { en: "both", he: "×©× ×™×”×", emoji: "ğŸ‘¥" },
        { en: "I want", he: "×× ×™ ×¨×•×¦×”", emoji: "ğŸ™‹" }, { en: "shop", he: "×—× ×•×ª", emoji: "ğŸ›’" },
        { en: "milkshake", he: "××™×œ×§×©×™×™×§", emoji: "ğŸ¥¤" }, { en: "short", he: "×§×¦×¨/× ××•×š", emoji: "ğŸ“" },
        { en: "wash", he: "×œ×©×˜×•×£", emoji: "ğŸ§¼" }, { en: "share", he: "×œ×—×œ×•×§", emoji: "ğŸ¤" },
        { en: "to shop", he: "×œ×§× ×•×ª", emoji: "ğŸ›ï¸" }, { en: "shopping", he: "×§× ×™×•×ª", emoji: "ğŸ›ï¸" },
        { en: "I need", he: "×× ×™ ×¦×¨×™×š", emoji: "âš ï¸" }, { en: "I have", he: "×™×© ×œ×™", emoji: "ğŸ¤²" },
        { en: "carrot", he: "×’×–×¨", emoji: "ğŸ¥•" }, { en: "fruit", he: "×¤×™×¨×•×ª", emoji: "ğŸ‡" },
        { en: "onion", he: "×‘×¦×œ", emoji: "ğŸ§…" }, { en: "peppers", he: "×¤×œ×¤×œ×™×", emoji: "ğŸ«‘" },
        { en: "table", he: "×©×•×œ×—×Ÿ", emoji: "ğŸŸ«" }, { en: "tomato", he: "×¢×’×‘× ×™×™×”", emoji: "ğŸ…" },
        { en: "vegetables", he: "×™×¨×§×•×ª", emoji: "ğŸ¥¦" }, { en: "tuna fish", he: "×˜×•× ×”", emoji: "ğŸŸ" },
        { en: "cake", he: "×¢×•×’×”", emoji: "ğŸ‚" }, { en: "list", he: "×¨×©×™××”", emoji: "ğŸ“œ" },
        { en: "put", he: "×œ×©×™×", emoji: "ğŸ“¥" }, { en: "birthday", he: "×™×•× ×”×•×œ×“×ª", emoji: "ğŸ¥³" },
        { en: "mouth", he: "×¤×”", emoji: "ğŸ‘„" }, { en: "teeth", he: "×©×™× ×™×™×", emoji: "ğŸ¦·" },
        { en: "thirsty", he: "×¦××", emoji: "ğŸš°" }, { en: "brother", he: "××—", emoji: "ğŸ‘¦" },
        { en: "father", he: "××‘×", emoji: "ğŸ‘¨" }, { en: "mother", he: "×××", emoji: "ğŸ‘©" },
        { en: "sing", he: "×œ×©×™×¨", emoji: "ğŸ¤" }, { en: "party", he: "××¡×™×‘×”", emoji: "ğŸˆ" },
        { en: "gift", he: "××ª× ×”", emoji: "ğŸ" }, { en: "thank you", he: "×ª×•×“×”", emoji: "ğŸ™" },
        { en: "color", he: "×¦×‘×¢", emoji: "ğŸ¨" }, { en: "number", he: "××¡×¤×¨", emoji: "ğŸ”¢" },
        { en: "favorite", he: "××”×•×‘", emoji: "ğŸŒŸ" }, { en: "eleven", he: "11", emoji: "1ï¸âƒ£1ï¸âƒ£" },
        { en: "twelve", he: "12", emoji: "1ï¸âƒ£2ï¸âƒ£" }, { en: "thirteen", he: "13", emoji: "1ï¸âƒ£3ï¸âƒ£" },
        { en: "fourteen", he: "14", emoji: "1ï¸âƒ£4ï¸âƒ£" }, { en: "fifteen", he: "15", emoji: "1ï¸âƒ£5ï¸âƒ£" },
        { en: "sixteen", he: "16", emoji: "1ï¸âƒ£6ï¸âƒ£" }, { en: "seventeen", he: "17", emoji: "1ï¸âƒ£7ï¸âƒ£" },
        { en: "eighteen", he: "18", emoji: "1ï¸âƒ£8ï¸âƒ£" }, { en: "nineteen", he: "19", emoji: "1ï¸âƒ£9ï¸âƒ£" },
        { en: "twenty", he: "20", emoji: "2ï¸âƒ£0ï¸âƒ£" }, { en: "Sunday", he: "×™×•× ×¨××©×•×Ÿ", emoji: "ğŸ“…" },
        { en: "Monday", he: "×™×•× ×©× ×™", emoji: "ğŸ“…" }, { en: "Tuesday", he: "×™×•× ×©×œ×™×©×™", emoji: "ğŸ“…" },
        { en: "Wednesday", he: "×™×•× ×¨×‘×™×¢×™", emoji: "ğŸ“…" }, { en: "Thursday", he: "×™×•× ×—××™×©×™", emoji: "ğŸ“…" },
        { en: "Friday", he: "×™×•× ×©×™×©×™", emoji: "ğŸ“…" }, { en: "Saturday", he: "×™×•× ×©×‘×ª", emoji: "ğŸ“…" },
        { en: "what day is today?", he: "××™×–×” ×™×•× ×”×™×•×?", emoji: "â“" },
        { en: "yesterday", he: "××ª××•×œ", emoji: "âª" }, { en: "today", he: "×”×™×•×", emoji: "âºï¸" },
        { en: "breakfast", he: "××¨×•×—×ª ×‘×•×§×¨", emoji: "ğŸ³" }, { en: "lunch", he: "××¨×•×—×ª ×¦×”×¨×™×™×", emoji: "ğŸ±" },
        { en: "dinner", he: "××¨×•×—×ª ×¢×¨×‘", emoji: "ğŸ¥—" }, { en: "what time is it?", he: "××” ×”×©×¢×”?", emoji: "âŒš" }
    ];

    const allSentences = [
        { q: "I eat ____ in the morning.", a: "breakfast" },
        { q: "My ____ is my dad's wife.", a: "mother" },
        { q: "A rabbit likes a ____.", a: "carrot" },
        { q: "The ____ is on the table.", a: "cake" },
        { q: "I have white ____.", a: "teeth" },
        { q: "____ is the first day.", a: "Sunday" },
        { q: "I drink ____.", a: "water" },
        { q: "A ____ with cheese.", a: "sandwich" },
        { q: "Go to the ____ for food.", a: "shop" },
        { q: "My ____ is in school.", a: "teacher" },
        { q: "A ____ of milk.", a: "drink" },
        { q: "A ____ with balloons.", a: "party" },
        { q: "The book is ____ the table.", a: "on" },
        { q: "I like to ____ songs.", a: "sing" },
        { q: "Ten plus one is ____.", a: "eleven" },
        { q: "I eat ____ at noon.", a: "lunch" },
        { q: "I eat ____ at night.", a: "dinner" },
        { q: "Sweet ____ is good.", a: "chocolate" },
        { q: "A yellow ____ is sour.", a: "lemon" },
        { q: "My ____ is my mom's husband.", a: "father" },
        { q: "We are a happy ____.", a: "family" },
        { q: "The ____ is small.", a: "baby" },
        { q: "I eat ____ and chips.", a: "chicken" },
        { q: "I like to ____ pizza.", a: "eat" },
        { q: "The cat is ____ the chair.", a: "under" },
        { q: "I ____ pizza. It's yummy.", a: "like" },
        { q: "Can you ____ your candy?", a: "share" },
        { q: "I ____ a new pen.", a: "need" },
        { q: "I ____ a big brother.", a: "have" },
        { q: "____ the apple before you eat.", a: "wash" },
        { q: "Tomato is a red ____.", a: "vegetable" },
        { q: "Apples are my favorite ____.", a: "fruit" },
        { q: "Put a ____ in the salad.", a: "tomato" },
        { q: "Mom's mother is my ____.", a: "grandmother" },
        { q: "Dad's father is my ____.", a: "grandfather" },
        { q: "I want to eat. I am ____.", a: "hungry" },
        { q: "I like ____ on bread.", a: "cheese" },
        { q: "Mom is in the ____.", a: "kitchen" },
        { q: "A birthday ____ for you.", a: "gift" },
        { q: "____ is before Saturday.", a: "Friday" },
        { q: "Ten plus ten is ____.", a: "twenty" },
        { q: "I like orange ____.", a: "juice" },
        { q: "We eat in a ____.", a: "restaurant" },
        { q: "My ____ is my mom's son.", a: "brother" },
        { q: "My ____ is my dad's daughter.", a: "sister" },
        { q: "A ____ is a small cake.", a: "cookie" },
        { q: "I drink hot ____.", a: "coffee" },
        { q: "Nine plus four is ____.", a: "thirteen" },
        { q: "Seven plus seven is ____.", a: "fourteen" },
        { q: "Ten plus five is ____.", a: "fifteen" },
        { q: "Eight plus eight is ____.", a: "sixteen" },
        { q: "Ten plus seven is ____.", a: "seventeen" },
        { q: "Today is Tuesday, ____ was Monday.", a: "yesterday" },
        { q: "I am ____. Give me juice.", a: "thirsty" },
        { q: "The ____ play in the park.", a: "children" },
        { q: "____ the book in the bag.", a: "put" },
        { q: "Blue is a ____.", a: "color" }
    ];

    let isSmallMobile = window.innerWidth <= 480;
    let sizeMatch = isSmallMobile ? 6 : 8;
    let sizeSentences = 8;
    let sizeImages = isSmallMobile ? 6 : 8;

    let selectedEng = null;
    let selectedWord = null;
    let connections = [];
    let isChecked = false;

    const connectionColors = ['#EBF8FF', '#FAF5FF', '#FFF5F5', '#F0FFF4', '#FFFFF0', '#E6FFFA', '#FFF5F7', '#F7FAFC'];

    const shuffle = (arr) => arr.sort(() => 0.5 - Math.random());

    function init() {
        const selSentences = shuffle([...allSentences]).slice(0, sizeSentences);
        const selEmojis = shuffle(fullList.filter(x => x.emoji)).slice(0, sizeImages);
        const usedInQuiz = new Set([...selSentences.map(s=>s.a), ...selEmojis.map(e=>e.en)]);
        const selMatch = shuffle(fullList.filter(w => !usedInQuiz.has(w.en))).slice(0, sizeMatch);

        const eCol = document.getElementById('eng-col'), hCol = document.getElementById('heb-col');
        
        selMatch.forEach(item => {
            const div = createEl('div', 'match-item', item.en, eCol);
            div.dataset.val = item.en;
            div.onclick = () => {
                if(isChecked) return;
                if(selectedEng) selectedEng.classList.remove('selected');
                selectedEng = div; div.classList.add('selected');
            };
        });

        shuffle([...selMatch]).forEach(item => {
            const div = createEl('div', 'match-item', item.he, hCol);
            div.dataset.val = item.he;
            div.onclick = () => {
                if(!selectedEng || isChecked) return;
                connections = connections.filter(c => c.from !== selectedEng && c.to !== div);
                const color = connectionColors[connections.length % connectionColors.length];
                connections.push({from: selectedEng, to: div, eng: selectedEng.dataset.val, heb: div.dataset.val, color: color});
                updateMatchingUI();
                selectedEng.classList.remove('selected');
                selectedEng = null;
            };
        });

        renderSection('s', selSentences.map(x=>x.a), selSentences);
        renderSection('i', selEmojis.map(x=>x.en), selEmojis);
    }

    function updateMatchingUI() {
        document.querySelectorAll('.match-item').forEach(el => {
            el.style.backgroundColor = "";
            el.style.borderColor = "";
        });
        connections.forEach(conn => {
            conn.from.style.backgroundColor = conn.color;
            conn.from.style.borderColor = "#cbd5e0";
            conn.to.style.backgroundColor = conn.color;
            conn.to.style.borderColor = "#cbd5e0";
        });
    }

    function renderSection(prefix, words, qs) {
        const bank = document.getElementById(`${prefix}-bank`), cont = document.getElementById(`${prefix}-questions`);
        shuffle(words).forEach(w => {
            const it = createEl('div', 'drag-item', w, bank);
            it.id = `${prefix}-${w}`;
            it.draggable = true; // ×”×¤×¢×œ×ª ×’×¨×™×¨×”
            
            // ××™×¨×•×¢×™ ×’×¨×™×¨×” (××—×©×‘)
            it.ondragstart = (e) => {
                if(isChecked) return;
                e.dataTransfer.setData("text", it.id);
                selectedWord = it;
            };

            // ××™×¨×•×¢×™ ×œ×—×™×¦×” (× ×™×™×“ + ×’×™×‘×•×™)
            it.onclick = () => {
                if(isChecked) return;
                if(selectedWord) selectedWord.classList.remove('selected-item');
                selectedWord = it;
                it.classList.add('selected-item');
            };
        });

        qs.forEach(q => {
            const d = document.createElement('div');
            if(prefix === 's') {
                d.className = "sentence-row";
                d.innerHTML = `<button class="speak-btn" onclick="speak('${q.q}')">ğŸ”Š</button> 
                               <span>${q.q.replace('____', `<div class="drop-zone" data-ans="${q.a}" ondragover="allowDrop(event)" ondragleave="clearDrag(event)" ondrop="handleDrop(event, 's')" onclick="handleFill(this, 's')"></div>`)}</span>`;
            } else {
                d.className = "img-card";
                d.innerHTML = `<span class="emoji-img">${q.emoji}</span>
                               <div class="img-drop-zone" data-ans="${q.en}" ondragover="allowDrop(event)" ondragleave="clearDrag(event)" ondrop="handleDrop(event, 'i')" onclick="handleFill(this, 'i')">×œ×—×¥ ×œ××™×œ×•×™</div>`;
            }
            cont.appendChild(d);
        });
    }

    // ×¤×•× ×§×¦×™×•×ª Drag & Drop
    function allowDrop(e) {
        e.preventDefault();
        if(!isChecked) e.target.classList.add('drag-over');
    }

    function clearDrag(e) {
        e.target.classList.remove('drag-over');
    }

    function handleDrop(e, prefix) {
        e.preventDefault();
        e.target.classList.remove('drag-over');
        if(isChecked) return;
        const id = e.dataTransfer.getData("text");
        const draggedEl = document.getElementById(id);
        if(draggedEl && id.startsWith(prefix)) {
            selectedWord = draggedEl;
            handleFill(e.target, prefix);
        }
    }

    function handleFill(zone, prefix) {
        if(isChecked || !selectedWord) return;
        if(selectedWord.id.split('-')[0] !== prefix) return;
        
        if(zone.innerText && zone.innerText !== "×œ×—×¥ ×œ××™×œ×•×™") {
            const oldWord = document.getElementById(`${prefix}-${zone.innerText}`);
            if(oldWord) oldWord.classList.remove('used');
        }
        zone.innerText = selectedWord.innerText;
        zone.style.color = "#2d3748";
        selectedWord.classList.add('used');
        selectedWord.classList.remove('selected-item');
        selectedWord = null;
    }

    function calculateGrade() {
        isChecked = true;
        let sCorr = 0, iCorr = 0, mCorr = 0;

        const engItems = document.querySelectorAll('#eng-col .match-item');
        engItems.forEach(item => {
            const engWord = item.dataset.val;
            const correctHeb = fullList.find(f => f.en === engWord).he;
            const conn = connections.find(c => c.eng === engWord);
            item.style.backgroundColor = "";
            if(conn && conn.heb === correctHeb) {
                mCorr++;
                conn.from.classList.add('checked-correct');
                conn.to.classList.add('checked-correct');
            } else {
                item.classList.add('checked-wrong');
                if(conn) conn.to.classList.add('checked-wrong');
                const hebElement = Array.from(document.querySelectorAll('#heb-col .match-item')).find(h => h.dataset.val === correctHeb);
                if(hebElement) {
                    hebElement.insertAdjacentHTML('beforeend', `<div style="font-size:0.75em; color:#276749; font-weight:normal; margin-top:2px;">(${engWord})</div>`);
                }
            }
        });

        document.querySelectorAll('.drop-zone, .img-drop-zone').forEach(z => {
            const val = z.innerText.trim().toLowerCase();
            const ans = z.dataset.ans.toLowerCase();
            const ok = val === ans;
            z.className += ok ? " correct-ans" : " wrong-ans";
            if(ok) z.classList.contains('drop-zone') ? sCorr++ : iCorr++;
            else {
                if(z.classList.contains('drop-zone')) z.insertAdjacentHTML('afterend', `<span class="correction-text">×ª×©×•×‘×”: ${z.dataset.ans}</span>`);
                else z.innerText = `âŒ (${z.dataset.ans})`;
            }
        });

        const score = Math.round((mCorr/sizeMatch)*30 + (sCorr/sizeSentences)*35 + (iCorr/sizeImages)*35);
        const res = document.getElementById('final-result');
        res.style.display = "block";
        document.getElementById('grade-text').innerText = `×”×¦×™×•×Ÿ ×©×œ×š: ${score}`;
        document.getElementById('main-btn').style.display = 'none';

        const emoji = document.getElementById('feedback-emoji');
        const msg = document.getElementById('feedback-msg');
        if(score >= 95) { emoji.innerText = "ğŸ‘‘"; msg.innerText = "××“×”×™×! ×¤×©×•×˜ ××•×©×œ×!"; }
        else if(score >= 85) { emoji.innerText = "ğŸŒŸ"; msg.innerText = "×›×œ ×”×›×‘×•×“! ×ª×•×¦××” ××¦×•×™× ×ª!"; }
        else if(score >= 70) { emoji.innerText = "ğŸ‘"; msg.innerText = "×˜×•×‘ ×××•×“! ××¤×©×¨ ×œ×”×©×ª×¤×¨ ×¢×•×“ ×§×¦×ª."; }
        else { emoji.innerText = "ğŸ’ª"; msg.innerText = "××œ ×ª×•×•×ª×¨, × ×¡×” ×©×•×‘ ×•×ª×¦×œ×™×—!"; }
        res.scrollIntoView({ behavior: 'smooth' });
    }

    function createEl(tag, cls, txt, parent) {
        const el = document.createElement(tag); el.className = cls; el.innerText = txt;
        if(parent) parent.appendChild(el); return el;
    }

    function speak(t) {
        const m = new SpeechSynthesisUtterance(t.replace("____", "blank"));
        m.lang = 'en-US'; window.speechSynthesis.speak(m);
    }

    init();
</script>
</body>
</html>
